<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife Hazard Analysis Tool</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#111827',
                            text: '#F3F4F6',
                            primary: '#F59E0B',
                            'primary-hover': '#D97706',
                            secondary: '#374151',
                            input: '#1F2937'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-brand-bg text-brand-text h-screen overflow-hidden flex flex-col">

    <!-- Header -->
    <header class="bg-brand-secondary p-4 shadow-md z-20 flex justify-between items-center shrink-0">
        <div class="flex items-center space-x-4">
            <h1 class="text-xl md:text-2xl font-bold text-white">Habitat-Scanner <span
                    class="text-brand-primary text-sm font-normal">v0.5</span></h1>
        </div>
        <div class="flex space-x-4">
            <button id="about-btn" class="text-sm text-gray-400 hover:text-white">About</button>
            <button id="start-over-btn" class="text-sm text-gray-400 hover:text-white">Start Over</button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden relative">

        <!-- Left Panel: Controls -->
        <div class="control-panel w-full md:w-1/4 min-w-[320px] bg-brand-bg border-r border-brand-secondary flex flex-col overflow-y-auto z-10 transition-transform duration-300 absolute md:relative h-full"
            id="left-panel">
            <div class="p-4 space-y-6">

                <!-- Input Section -->
                <div>
                    <h2 class="text-lg font-semibold text-brand-primary mb-2">Analysis Parameters</h2>
                    <div class="flex mb-4 rounded-lg overflow-hidden border border-brand-secondary">
                        <button id="tab-icao"
                            class="flex-1 py-2 bg-brand-primary text-black font-semibold">ICAO</button>
                        <button id="tab-coords"
                            class="flex-1 py-2 bg-brand-secondary text-gray-300 hover:bg-gray-700">Coords</button>
                    </div>

                    <div id="panel-icao" class="space-y-3">
                        <div>
                            <label class="block text-xs text-gray-400 uppercase tracking-wider mb-1">Airport
                                Code</label>
                            <input type="text" id="icao-input"
                                class="w-full bg-brand-input border border-brand-secondary rounded p-2 text-white focus:border-brand-primary focus:outline-none"
                                placeholder="e.g., HECA">
                        </div>
                    </div>

                    <div id="panel-coords" class="hidden space-y-3">
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label
                                    class="block text-xs text-gray-400 uppercase tracking-wider mb-1">Latitude</label>
                                <input type="text" id="lat-input"
                                    class="w-full bg-brand-input border border-brand-secondary rounded p-2 text-white focus:border-brand-primary focus:outline-none"
                                    placeholder="27.18">
                            </div>
                            <div>
                                <label
                                    class="block text-xs text-gray-400 uppercase tracking-wider mb-1">Longitude</label>
                                <input type="text" id="lon-input"
                                    class="w-full bg-brand-input border border-brand-secondary rounded p-2 text-white focus:border-brand-primary focus:outline-none"
                                    placeholder="33.79">
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 mt-3">
                        <div>
                            <label class="block text-xs text-gray-400 uppercase tracking-wider mb-1">Radius (km)</label>
                            <input type="number" id="radius-input" value="13"
                                class="w-full bg-brand-input border border-brand-secondary rounded p-2 text-white focus:border-brand-primary focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-400 uppercase tracking-wider mb-1">Min Area
                                (m²)</label>
                            <input type="number" id="min-area-input" value="5000"
                                class="w-full bg-brand-input border border-brand-secondary rounded p-2 text-white focus:border-brand-primary focus:outline-none">
                        </div>
                    </div>

                    <button id="submit-btn"
                        class="mt-4 w-full bg-brand-primary hover:bg-brand-primary-hover text-black font-bold py-3 rounded transition-colors flex justify-center items-center">
                        <span>Run Analysis</span>
                        <div id="submit-btn-loader" class="loader hidden ml-2"></div>
                    </button>
                    <div id="status-message" class="text-center text-sm mt-2 min-h-[20px]"></div>
                </div>

                <!-- Filters (Hidden initially) -->
                <div id="filters-section" class="hidden border-t border-brand-secondary pt-4">
                    <h2 class="text-lg font-semibold text-brand-primary mb-2">Filters</h2>
                    <div class="space-y-2">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" checked
                                class="form-checkbox text-brand-primary rounded bg-brand-input border-brand-secondary"
                                data-filter="waste">
                            <span class="text-sm">Waste / Industrial</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" checked
                                class="form-checkbox text-blue-500 rounded bg-brand-input border-brand-secondary"
                                data-filter="water">
                            <span class="text-sm">Water Bodies</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="checkbox" checked
                                class="form-checkbox text-green-500 rounded bg-brand-input border-brand-secondary"
                                data-filter="veg">
                            <span class="text-sm">Vegetation</span>
                        </label>
                    </div>
                </div>

                <!-- Downloads (Hidden initially) -->
                <div id="downloads-section" class="hidden border-t border-brand-secondary pt-4">
                    <h2 class="text-lg font-semibold text-brand-primary mb-2">Export</h2>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="download-kml-btn"
                            class="bg-brand-secondary hover:bg-gray-600 text-white py-2 rounded text-sm">KML</button>
                        <button id="download-csv-btn"
                            class="bg-brand-secondary hover:bg-gray-600 text-white py-2 rounded text-sm">CSV</button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Right Panel: Map & Dashboard -->
        <div class="flex-1 flex flex-col relative h-full">

            <!-- Map Area -->
            <div id="map" class="flex-1 bg-gray-900 z-0"></div>

            <!-- Dashboard Overlay (Bottom) -->
            <div id="dashboard-panel"
                class="h-1/3 bg-brand-bg/95 backdrop-blur border-t border-brand-secondary absolute bottom-0 w-full z-10 transition-transform duration-300 transform translate-y-full flex flex-col">

                <!-- Toggle Handle -->
                <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-brand-bg border border-brand-secondary border-b-0 rounded-t-lg px-4 py-1 cursor-pointer hover:bg-brand-secondary"
                    id="dashboard-toggle">
                    <span class="text-xs font-bold text-brand-primary">DASHBOARD</span>
                </div>

                <div class="flex-1 flex overflow-hidden p-4 space-x-4">

                    <!-- Stats Cards -->
                    <div class="w-1/4 min-w-[200px] flex flex-col space-y-2 overflow-y-auto">
                        <div class="bg-brand-input p-3 rounded border border-brand-secondary">
                            <div class="text-xs text-gray-400">Total Habitats</div>
                            <div class="text-2xl font-bold text-white" id="stat-total">0</div>
                        </div>

                        <!-- Analysis Log -->
                        <div class="bg-brand-input p-3 rounded border border-brand-secondary flex-1 overflow-y-auto">
                            <div class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-wider">Analysis Log
                            </div>
                            <div id="analysis-log" class="text-[10px] text-gray-300 space-y-1 font-mono">
                                <p class="text-gray-500 italic">Run analysis to see details...</p>
                            </div>
                        </div>
                        <div class="bg-brand-input p-3 rounded border border-brand-secondary">
                            <div class="text-xs text-gray-400">High Risk</div>
                            <div class="text-2xl font-bold text-red-500" id="stat-high-risk">0</div>
                        </div>
                        <div class="bg-brand-input p-3 rounded border border-brand-secondary">
                            <div class="text-xs text-gray-400">Total Area (km²)</div>
                            <div class="text-2xl font-bold text-brand-primary" id="stat-area">0</div>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div
                        class="w-1/4 min-w-[200px] bg-brand-input rounded border border-brand-secondary p-2 flex justify-center items-center">
                        <canvas id="hazardChart"></canvas>
                    </div>

                    <!-- Feature List -->
                    <div
                        class="flex-1 bg-brand-input rounded border border-brand-secondary overflow-hidden flex flex-col">
                        <div <div
                            class="p-2 border-b border-brand-secondary bg-brand-secondary/50 flex justify-between text-xs font-bold text-gray-300">
                            <span class="w-1/3 flex items-center">
                                Type
                                <div class="group relative ml-1">
                                    <span class="cursor-help text-gray-500 hover:text-white">(?)</span>
                                    <div
                                        class="hidden group-hover:block absolute left-0 top-full mt-1 w-48 bg-gray-800 text-gray-200 text-[10px] p-2 rounded border border-gray-600 z-50">
                                        Types of wildlife attractants found. Waste/Industrial sites pose higher risks
                                        than Vegetation.
                                    </div>
                                </div>
                            </span>
                            <span class="w-1/4 text-right flex items-center justify-end">
                                Risk
                                <div class="group relative ml-1">
                                    <span class="cursor-help text-gray-500 hover:text-white">(?)</span>
                                    <div
                                        class="hidden group-hover:block absolute right-0 top-full mt-1 w-48 bg-gray-800 text-gray-200 text-[10px] p-2 rounded border border-gray-600 z-50">
                                        Score (1-10) based on:
                                        <br>1. Distance to ARP (Closer = Higher)
                                        <br>2. Area Size (Larger = Higher)
                                        <br>3. Type (Waste > Water > Veg)
                                    </div>
                                </div>
                            </span>
                            <span class="w-1/4 text-right">Dist (km)</span>
                            <span class="w-16 text-center">Action</span>
                        </div>
                        <div class="overflow-y-auto flex-1 p-1 space-y-1" id="feature-list">
                            <!-- Items will be injected here -->
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center">
        <div
            class="bg-brand-secondary text-brand-text p-6 rounded-lg shadow-xl w-11/12 max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-white">About Habitat-Scanner</h2>
                <button id="close-about-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <div class="prose prose-invert max-w-none text-sm">
                <p class="text-gray-300">The <strong>Habitat Scanner Tool</strong> is an advanced geospatial analysis
                    platform designed to identify and assess wildlife attractants near airports. By combining
                    <strong>OpenStreetMap</strong> and <strong>Satellite Imagery</strong>, it provides comprehensive
                    risk assessments for aviation safety professionals.</p>

                <h3 class="text-brand-primary mt-4 mb-2">Key Features</h3>
                <ul class="list-disc pl-5 text-gray-300 space-y-1">
                    <li><strong>Dual-Source Intelligence:</strong> OpenStreetMap for verified land use + Satellite
                        imagery for comprehensive water body detection</li>
                    <li><strong>Risk Scoring Algorithm:</strong> Calculates risk (1-10) based on distance, area, and
                        habitat type</li>
                    <li><strong>Interactive Dashboard:</strong> Real-time statistics, charts, and detailed feature lists
                    </li>
                    <li><strong>Smart Classification:</strong> Accurately categorizes waste, water, and vegetation
                        habitats</li>
                    <li><strong>Export Capabilities:</strong> Download KML and CSV files with complete habitat data</li>
                    <li><strong>Specific Naming:</strong> Displays actual habitat names (e.g., "River Nile", "Lake
                        Nasser")</li>
                </ul>

                <h3 class="text-brand-primary mt-4 mb-2">What's New in V 06</h3>
                <ul class="list-disc pl-5 text-gray-300 space-y-1">
                    <li>Optimized satellite data (water-only detection)</li>
                    <li>Airport infrastructure exclusion (no false positives)</li>
                    <li>Improved geometry handling (automatic repair)</li>
                    <li>Smart download filenames (includes ICAO/coordinates)</li>
                    <li>Enhanced mobile responsiveness</li>
                    <li>Distance to ARP in all displays</li>
                </ul>

                <h3 class="text-brand-primary mt-4 mb-2">How It Works</h3>
                <ol class="list-decimal pl-5 text-gray-300 space-y-1">
                    <li>Enter an ICAO code or coordinates</li>
                    <li>Set analysis radius and minimum area threshold</li>
                    <li>System fetches data from OSM and satellite sources</li>
                    <li>Habitats are classified, scored, and displayed on the map</li>
                    <li>Export results for further analysis or reporting</li>
                </ol>

                <p class="text-gray-400 text-xs mt-4">Version 0.6 | Powered by OpenStreetMap, Google Earth Engine, and
                    Leaflet</p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>

</html>